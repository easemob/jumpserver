{% extends '_modal.html' %}
{% load i18n %}
{% load static %}

{% block modal_class %}modal-lg{% endblock %}
{% block modal_id %}create_argument_modal{% endblock %}
{% block modal_title %}{% trans "创建变量" %}{% endblock %}
{% block modal_body %}
    <style>
        .inmodal .modal-header {
            padding: 10px 10px;
            text-align: center;
        }

    </style>

    <div class="wrapper wrapper-content" style="max-height: 500px; overflow-y: scroll">
        <form id="argument-form" method="post" action="" class="form-horizontal">
            {% csrf_token %}
            <div class="form-group required">
                <label for="name" class="col-sm-2 control-label">变量名称</label>
                <div class="col-sm-9">
                    <input required="true" type="text" class="form-control" name="name" id="name"
                           placeholder="">
                </div>
            </div>

            <div class="form-group required">
                <label for="default-value" class="col-sm-2 control-label">默认值</label>
                <div class="col-sm-9">
                    <input required="true" type="text" class="form-control" name="default_value" id="default-value"
                           placeholder="">
                </div>
            </div>

            <div class="form-group">
                <label for="description" class="col-sm-2 control-label">变量描述</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control" name="description" id="description"
                           placeholder="">
                </div>
            </div>

            <div class="form-group required">
                <label for="constraint-regex" class="col-sm-2 control-label">正则限制</label>
                <div class="col-sm-9">
                    <input required="true" type="text" class="form-control" name="constraint_regex"
                           id="constraint-regex"
                           value=".*">
                </div>
            </div>

            <div class="form-group required">
                <label for="constraint-description" class="col-sm-2 control-label">限制描述</label>
                <div class="col-sm-9">
                    <input required="true" type="text" class="form-control" name="constraint_description"
                           id="constraint-description"
                           placeholder="">
                </div>
            </div>

            <div class="row">
                <div class="col-sm-9 col-sm-offset-2">
                    <button style="width:100%" class="btn btn-primary" type="submit">提 交</button>
                </div>
            </div>
        </form>
    </div>

    <script>
      function validate_default_value() {
        var default_value = $('input[name="default_value"]').val()
        var constraint_regex = $('input[name="constraint_regex"]').val()
        if (!!default_value && !!constraint_regex) {
          return new RegExp(constraint_regex).test(default_value)
        } else {
          return true
        }
      }

      $(document).ready(function () {

      }).on('submit', '#argument-form', function (evt) {
        evt.preventDefault();
        if (!validate_default_value()) {
          swal('表单验证失败', '默认值和正则限制不匹配，请重新设置默认值', 'error')
          return false
        }
        var url = '{% url "api-ops:task-argument-list" %}'
        var props = {
          url: url,
          method: 'POST',
          form: $('#argument-form'),
          error: function (jqXHR) {
            toastr.error(jqXHR.responseText)
          },
          success: function () {
            window.location.href = '{% url "ops:task-argument-list" %}'
          }
        }
        formSubmit(props);
      })
    </script>
{% endblock %}

{% block modal_button %}
    <button id="close_button2" data-dismiss="modal" class="btn btn-white close_btn2"
            type="button">{% trans "Close" %}</button>
{% endblock %}



