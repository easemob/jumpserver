{% extends 'base.html' %}
{% load static %}
{% load bootstrap3 %}
{% load i18n %}
{% load common_tags %}

{% block content %}
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="tab-content">
                        <div class="ibox-content" style="border-width: 0;padding-top: 40px;">
                            <div class="uc pull-left m-r-10" style="padding-bottom: 5px">
                                <button class="btn btn-sm btn-primary btn-template-create"> {% trans "Create template" %} </button>
                                <form action="" class="form-inline" style="display: inline-block;padding-left: 20px;">
                                    <div class="form-group" id="date">
                                        <div class="input-daterange input-group" id="datepicker">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" class="input-sm form-control" style="width: 150px;"
                                                   name="date_from">
                                            <span class="input-group-addon">to</span>
                                            <input type="text" class="input-sm form-control" style="width: 150px;"
                                                   name="date_to">
                                        </div>
                                    </div>

                                </form>

                            </div>

                            <table class="table table-striped table-bordered table-hover " id="task_template_list_table"
                                   style="width: 100%">
                                <thead>
                                <tr>
                                    <th class="text-center"><input type="checkbox" class="ipt_check_all"></th>
                                    <th class="text-center">{% trans 'Name' %}</th>
                                    <th class="text-center">{% trans '周期任务' %}</th>
                                    <th class="text-center">{% trans 'User' %}</th>
                                    <th class="text-center">{% trans 'Date' %}</th>
                                    <th class="text-center">{% trans 'Action' %}</th>

                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>

                            <div id="actions" class="hide">
                                <div class="input-group">
                                    <select class="form-control m-b" style="width: auto" id="slct_bulk_update">
                                        <option value="remove">删除</option>
                                    </select>
                                    <div class="input-group-btn pull-left" style="padding-left: 5px;">
                                        <button id='btn_bulk_update' style="height: 32px;"
                                                class="btn btn-sm btn-primary">
                                            {% trans 'Submit' %}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
{% endblock %}
{% block custom_foot_js %}
    <script>
      var asset_table = 0

      function initTable() {
        var options = {
          ele: $('#task_template_list_table'),
          columnDefs: [
            {
              targets: 1, createdCell: function (td, cellData, rowData) {
                cellData = htmlEscape(cellData);
                {% url 'ops:task-detail' pk=DEFAULT_PK as the_url  %}
                var html = ''
                html += '<a href="{{ the_url }} }}">' + cellData + '</a>'.replace('{{ DEFAULT_PK }}', rowData.id)
                $(td).html(html);
              }
            },

            {
              targets: 2, createdCell: function (td, cellData, rowData) {
                var html = ''
                if (cellData) {
                  html = rowData.crontab
                } else {
                  html = '否'
                }
                console.log(html)
                $(td).html(html);
              }
            },
            {
              targets: 4, createdCell: function (td, cellData) {
                var html = ''
                html += new Date(htmlEscape(cellData)).toLocaleDateString();
                $(td).html(html);
              }
            },
            {
              targets: 5, createdCell: function (td, cellData) {
                var html = ''
                html += '<a class="btn btn-xs btn-warning m-l-xs btn_asset_update" data-uid="{{ DEFAULT_PK }}">修改</a>'.replace('{{ DEFAULT_PK }}', cellData);
                html += '<a class="btn btn-xs btn-danger m-l-xs btn_asset_info" data-uid="{{ DEFAULT_PK }}">删除</a>'.replace('{{ DEFAULT_PK }}', cellData);

                $(td).html(html)
              }
            }
          ],
          ajax_url: '{% url "api-ops:task-template-list" %}',
          columns: [
            {data: "id", orderable: false},
            {data: "name", orderable: false},
            {data: "is_periodic", orderable: false},
            {data: "created_by", orderable: false},
            {data: "date_created"},
            {data: "id", orderable: false},
          ],
          op_html: $('#actions').html()
        };
        asset_table = jumpserver.initServerSideDataTable(options);
        return asset_table
      }

      $(document).ready(function () {
        initTable()
        $('#asset_list_modal').modal('show');

      }).on('click', '.btn-template-create', function () {
        var url = "{% url 'ops:file-task-create' %}";
        window.open(url, '_self');
      })

    </script>
{% endblock %}
